<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DSC Inventory - Obsidian</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
  </style>
</head>
<body class="bg-slate-950 text-slate-300 antialiased selection:bg-blue-500 selection:text-white">
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // ============================================================================
    // CONFIGURATION
    // ============================================================================
    
    const SITE_PASSWORD = 'CompassTesting2025!';
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwI1CQee4vfNrY24orwXja0bK63hyofF_JPwuZATwQ3CxDjyLZOyByQiRL7huHBVPgF/exec';

    // ============================================================================
    // SOUND UTILS
    // ============================================================================

    const playSound = (type) => {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'success') {
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } else {
        oscillator.frequency.value = 300;
        oscillator.type = 'sawtooth';
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      }
    };

    // ============================================================================
    // LOGIN COMPONENT
    // ============================================================================
    
    function LoginScreen({ onLogin }) {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleSubmit = (e) => {
        e.preventDefault();
        if (password === SITE_PASSWORD) {
          onLogin();
        } else {
          setError('Incorrect password');
          setPassword('');
          playSound('error');
        }
      };

      return (
        <div className="min-h-screen bg-slate-950 flex items-center justify-center p-6 relative overflow-hidden">
          {/* Ambient Glow */}
          <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-blue-900/20 rounded-full blur-3xl pointer-events-none"></div>

          <div className="relative z-10 w-full max-w-md bg-slate-900/80 backdrop-blur-xl border border-slate-800 rounded-2xl shadow-2xl overflow-hidden">
            <div className="p-8 pb-0 text-center">
              <div className="w-16 h-16 bg-blue-600/10 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-blue-500/20">
                <svg xmlns="http://www.w3.org/2000/svg"
                  width="32"
                  height="32"
                  fill="#3fb0e9"
                  viewBox="0 0 256 256">
                  <path d="M128,112a28,28,0,0,0-8,54.83V184a8,8,0,0,0,16,0V166.83A28,28,0,0,0,128,112Zm0,40a12,12,0,1,1,12-12A12,12,0,0,1,128,152Zm80-72H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"></path>
                </svg>
              </div>
              <h1 className="text-2xl font-bold text-white tracking-wide mb-2 uppercase">DSC Inventory</h1>
              <p className="text-slate-500 text-sm tracking-widest">AUTHORIZED ACCESS ONLY</p>
            </div>
            
            <div className="p-8">
              <form onSubmit={handleSubmit}>
                <div className="mb-6">
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="Scan or Enter Password"
                    className="w-full bg-slate-950 border border-slate-800 text-white text-center text-lg rounded-xl p-4 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-slate-700 shadow-inner font-mono tracking-widest"
                    autoFocus
                  />
                </div>
                
                {error && (
                  <div className="mb-6 p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center justify-center gap-2">
                    <span className="text-red-400">⚠️</span>
                    <p className="text-red-400 text-sm">{error}</p>
                  </div>
                )}
                
                <button
                  type="submit"
                  className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-[0_0_20px_-5px_rgba(37,99,235,0.5)] uppercase tracking-wider text-sm"
                >
                  Access System
                </button>
              </form>
            </div>
          </div>
        </div>
      );
    }

    // ============================================================================
    // MAIN TRACKER COMPONENT
    // ============================================================================

    function PartsTracker() {
      // Auth State
      const [isAuthenticated, setIsAuthenticated] = useState(() => sessionStorage.getItem('partsTrackerAuth') === 'true');

      // Configuration State
      const [validNames, setValidNames] = useState([]);
      const [validParts, setValidParts] = useState([]);
      const [validLocations, setValidLocations] = useState([]);
      const [isLoadingConfig, setIsLoadingConfig] = useState(true);
      
      // Session State
      const [action, setAction] = useState('');
      const [locationName, setLocationName] = useState('');
      const [employeeName, setEmployeeName] = useState('');
      
      // Logic State
      const [scanMode, setScanMode] = useState('action');
      const [parts, setParts] = useState([]);
      const [currentPart, setCurrentPart] = useState('');
      const [isSubmitting, setIsSubmitting] = useState(false);
      
      // UI State
      const [scanInput, setScanInput] = useState('');
      const [suggestions, setSuggestions] = useState([]);
      const [statusMessage, setStatusMessage] = useState('Select Action: Receive, Send');
      const [statusType, setStatusType] = useState('neutral');
      const [showSuccessScreen, setShowSuccessScreen] = useState(false);
      const [lastSubmission, setLastSubmission] = useState(null);
      const inputRef = useRef(null);

      // --- HELPER FUNCTIONS ---

      const handleLogin = () => {
        setIsAuthenticated(true);
        sessionStorage.setItem('partsTrackerAuth', 'true');
      };

      const resetSession = () => {
        setAction('');
        setLocationName('');
        setEmployeeName('');
        setParts([]);
        setCurrentPart('');
        setScanMode('action');
        setScanInput('');
        setSuggestions([]);
        setStatusMessage('Select Action: Receive, Send');
        setStatusType('neutral');
        setShowSuccessScreen(false);
        setLastSubmission(null);
        playSound('success');
      };

      const setStatus = (msg, type = 'neutral') => {
        setStatusMessage(msg);
        setStatusType(type);
      };
      
      const getCurrentPrompt = () => {
        switch(scanMode) {
          case 'action': return 'Step 1: Select Action (Receive, Send)';
          case 'location': return 'Step 2: Scan or Enter Location Name';
          case 'employee': return 'Step 3: Scan or Enter Employee Name ';
          case 'part': return parts.length > 0 ? 'Step 4: Scan Next Part (or click Submit)' : 'Step 4: Scan Part Name';
          case 'quantity': return 'Step 5: Scan or Enter Quantity';
          default: return 'Scanner ready...';
        }
      };

      // --- FETCH CONFIG ---
      useEffect(() => {
        const fetchConfig = async () => {
          try {
            if (isAuthenticated) {
              console.log("Fetching config from Google Sheets...");
              const response = await fetch(GOOGLE_SCRIPT_URL);
              const data = await response.json();
              
              if (data.names && data.parts) {
                setValidNames(data.names);
                setValidParts(data.parts);
                setValidLocations(data.locations || []);
                setIsLoadingConfig(false);
              } else {
                setStatus('Error: Config data missing names/parts', 'error');
              }
            }
          } catch (error) {
            console.error("Config Fetch Error:", error);
            setStatus('Failed to load parts list. Check internet.', 'error');
          }
        };

        fetchConfig();
      }, [isAuthenticated]);

      // Focus Management
      useEffect(() => {
        if (inputRef.current && !showSuccessScreen && !isLoadingConfig) inputRef.current.focus();
      }, [scanMode, parts, showSuccessScreen, isLoadingConfig]);


      // --- INPUT CHANGE HANDLER (FOR TYPEAHEAD) ---
      const handleInputChange = (e) => {
        const value = e.target.value;
        setScanInput(value);

        // Only search if we are in 'part' mode
        if (scanMode === 'part' && value.length > 0) {
            const matches = validParts.filter(p => 
                p.toLowerCase().includes(value.toLowerCase())
            ).slice(0, 50); // Limit to 50 results
            setSuggestions(matches);
        } else {
            setSuggestions([]);
        }
      };

      // --- SELECTION HANDLER (CLICKING A SUGGESTION) ---
      const selectSuggestion = (partName) => {
        setSuggestions([]);
        setScanInput('');
        setCurrentPart(partName);
        setScanMode('quantity');
        setStatus(`Part: ${partName}. Enter Quantity.`, 'success');
        playSound('success');
      };

      // --- CORE SCAN LOGIC (ENTER KEY) ---
      const handleScan = (e) => {
        if (e.key === 'Enter') {
          const value = scanInput.trim();
          if (!value) return;

          setSuggestions([]); // Clear suggestions on Enter

          // SELECT ACTION
          if (scanMode === 'action') {
            const lowerVal = value.toLowerCase();
            
            // --- IF RECEIVE ---
            if (lowerVal.includes('receive') || value === '1') {
              setAction('Receive');
              setLocationName('Vendor / Inbound');
              setScanMode('employee');
              setStatus('Action: RECEIVE. Scan Employee Name.', 'success');
              playSound('success');
            } 
            // --- IF SEND ---
            else if (lowerVal.includes('send') || value === '2') {
              setAction('Send');
              setScanMode('location');
              setStatus('Action: SEND. Scan Destination.', 'success');
              playSound('success');
            } 
            else {
              setStatus('Invalid Action. Scan 1 or 2.', 'error');
              playSound('error');
            }
          }

          // SCAN LOCATION
          else if (scanMode === 'location') {
            const isPart = validParts.some(p => p.toLowerCase() === value.toLowerCase());
            const isName = validNames.some(n => n.toLowerCase() === value.toLowerCase());

            if (isPart || isName) {
              setStatus('Input looks like a Part or Name. Please scan Location Name.', 'error');
              playSound('error');
            } else {
              setLocationName(value);
              setScanMode('employee');
              setStatus(`Location: ${value}. Now scan Employee Name.`, 'success');
              playSound('success');
            }
          }

          // SCAN EMPLOYEE NAME
          else if (scanMode === 'employee') {
            const matchedName = validNames.find(name => 
              name.toLowerCase() === value.toLowerCase()
            );
            if (matchedName) {
              setEmployeeName(matchedName);
              setScanMode('part');
              setStatus(`Employee ${matchedName} logged. Start scanning parts.`, 'success');
              playSound('success');
            } else {
              const isPart = validParts.some(p => p.toLowerCase() === value.toLowerCase());
              if (isPart) {
                setStatus(`Scanned input is a Part. Please scan Employee Name.`, 'error');
              } else {
                setStatus(`Unknown Technician: "${value}". Check spelling or Config sheet.`, 'error');
              }
              playSound('error');
            }
          }

          // SCAN PART
          else if (scanMode === 'part') {
            const matchedPart = validParts.find(p => p.toLowerCase() === value.toLowerCase());

            if (matchedPart) {
              setCurrentPart(matchedPart);
              setScanMode('quantity');
              setStatus(`Part: ${matchedPart}. Enter Quantity.`, 'success');
              playSound('success');
            } else {
              setStatus(`Invalid Part: ${value}`, 'error');
              playSound('error');
            }
          }

          // SCAN QUANTITY
          else if (scanMode === 'quantity') {
            const qty = parseInt(value);
            if (!isNaN(qty) && qty > 0) {
              addPart(currentPart, qty);
              setCurrentPart('');
              setScanMode('part');
              setStatus(`Added ${qty}x ${currentPart}. Scan next part or Submit.`, 'success');
              playSound('success');
            } else {
              setStatus('Invalid Quantity. Enter a positive number.', 'error');
              playSound('error');
            }
          }

          setScanInput('');
        }
      };
      
      const addPart = (partName, qty) => {
        setParts([...parts, { id: Date.now(), part: partName, quantity: qty }]);
      };

      const removePart = (id) => {
        setParts(parts.filter(p => p.id !== id));
      };

      const handleSubmit = async () => {
        if (!action || !locationName || !employeeName || parts.length === 0) {
          setStatus('Cannot submit: Missing Action, Site, Employee, or Parts.', 'error');
          playSound('error');
          return;
        }

        setIsSubmitting(true);
        setStatus('Syncing with Google Sheets...', 'neutral');

        const submissionData = {
          secretKey: SITE_PASSWORD,
          action: action,
          locationName: locationName,
          employeeName: employeeName,
          timestamp: new Date().toISOString(),
          parts: parts
        };

        try {
          await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(submissionData)
          });
          
          setLastSubmission(submissionData);
          setShowSuccessScreen(true);
          setIsSubmitting(false);
          playSound('success');

        } catch (error) {
          console.error('Submission error:', error);
          setStatus('Upload Failed. Check console.', 'error');
          playSound('error');
          setIsSubmitting(false);
        }
      };

      // --- RENDERING ---

      if (!isAuthenticated) return <LoginScreen onLogin={handleLogin} />;

      // LOADING SCREEN
      if (isLoadingConfig) {
        return (
          <div className="min-h-screen bg-slate-950 flex items-center justify-center">
            <div className="text-center">
              <div className="text-6xl mb-4 animate-bounce">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="48"
                  height="48"
                  fill="#3fb0e9"
                  viewBox="0 0 256 256"
                  className="mx-auto">
                  <path d="M152,96H104a8,8,0,0,0-8,8v48a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V104A8,8,0,0,0,152,96Zm-8,48H112V112h32Zm88,0H216V112h16a8,8,0,0,0,0-16H216V56a16,16,0,0,0-16-16H160V24a8,8,0,0,0-16,0V40H112V24a8,8,0,0,0-16,0V40H56A16,16,0,0,0,40,56V96H24a8,8,0,0,0,0,16H40v32H24a8,8,0,0,0,0,16H40v40a16,16,0,0,0,16,16H96v16a8,8,0,0,0,16,0V216h32v16a8,8,0,0,0,16,0V216h40a16,16,0,0,0,16-16V160h16a8,8,0,0,0,0-16Zm-32,56H56V56H200v95.87s0,.09,0,.13,0,.09,0,.13V200Z">
                  </path>
                </svg>
              </div>
              <h2 className="text-2xl font-bold text-blue-400 mb-2">Connecting to Inventory...</h2>
              <p className="text-slate-500">Downloading Parts & Names</p>
            </div>
          </div>
        );
      }
      
      // SUCCESS SCREEN
      if (showSuccessScreen) {
        return (
          <div className="min-h-screen bg-slate-950 flex items-center justify-center p-4">
            <div className="bg-slate-900 rounded-lg shadow-2xl p-8 w-full max-w-md border border-green-500/50">
              <div className="text-center mb-6">
                <div className="text-6xl mb-4 text-green-400">✅</div>
                <h2 className="text-3xl font-bold text-green-400 mb-2">Submitted!</h2>
                <p className="text-slate-300">Data saved to Google Sheets</p>
              </div>
              
              {lastSubmission && (
                <div className="bg-slate-950 rounded p-4 mb-6 text-sm border border-slate-800">
                  <p className="text-slate-400">Action: <span className="text-white">{lastSubmission.action}</span></p>
                  <p className="text-slate-400">Location: <span className="text-white">{lastSubmission.locationName}</span></p>
                  <p className="text-slate-400">Employee: <span className="text-white">{lastSubmission.employeeName}</span></p>
                  <p className="text-slate-400">Total Parts: <span className="text-white">{lastSubmission.parts.reduce((sum, part) => sum + Number(part.quantity), 0)}</span></p>
                </div>
              )}
              
              <button
                onClick={resetSession}
                className="w-full bg-blue-600 hover:bg-blue-700 text-center text-white font-semibold py-4 px-4 rounded transition-colors text-lg"
              >
                <svg
                xmlns="http://www.w3.org/2000/svg"
                width="64"
                height="64"
                fill="#ffffff"
                viewBox="0 0 256 256"
                className="mx-auto">
                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm45.66-93.66a8,8,0,0,1,0,11.32l-32,32a8,8,0,0,1-11.32-11.32L148.69,136H88a8,8,0,0,1,0-16h60.69l-18.35-18.34a8,8,0,0,1,11.32-11.32Z">
                </path>
              </svg> Start New Session
              </button>
            </div>
          </div>
        );
      }

      // MAIN TRACKER UI
      return (
        <div className="min-h-screen bg-slate-950 p-4 lg:p-8 font-sans">
          
          {/* TOP NAVBAR */}
          <div className="max-w-6xl mx-auto mb-8 bg-slate-900/50 backdrop-blur border border-slate-800 p-4 rounded-xl flex flex-col md:flex-row justify-between items-center gap-4">
            <div className="flex items-center gap-4">
              <div className="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold shadow-[0_0_15px_rgba(37,99,235,0.3)]">
                DSC
              </div>
              <div>
                <h1 className="text-white font-bold leading-none tracking-wide">INVENTORY TRACKER</h1>
                <div className="flex gap-3 text-s mt-1 text-slate-400 font-mono">
                  <span>ACTION: <span className="text-blue-400">{action || '---'}</span></span>
                  <span>|</span>
                  <span>LOCATION: <span className="text-blue-400">{locationName || '---'}</span></span>
                  <span>|</span>
                  <span>EMPLOYEE: <span className="text-green-400">{employeeName || '---'}</span></span>
                </div>
              </div>
            </div>
            
            <button onClick={resetSession} className="px-4 py-2 rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors text-xs font-bold uppercase tracking-wider">
              Reset / New Session
            </button>
          </div>

          <div className="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            {/* LEFT COLUMN: SCANNER INPUT */}
            <div className="lg:col-span-2 space-y-6">
              <div className="bg-slate-900/80 backdrop-blur-xl border border-slate-800 p-6 rounded-2xl shadow-xl relative z-20">
                {/* Glowing Top Border */}
                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-600 via-indigo-500 to-blue-600 opacity-50 rounded-t-2xl"></div>

                {/* Status Message Display */}
                <div className={`mb-6 p-4 rounded-xl border ${
                  statusType === 'error' ? 'bg-red-500/10 border-red-500/50 text-red-200' :
                  statusType === 'success' ? 'bg-green-500/10 border-green-500/50 text-green-200' :
                  'bg-blue-500/10 border-blue-500/30 text-blue-200'
                } transition-all duration-300`}>
                  <p className="font-medium flex items-center gap-3 text-lg">
                    <span className="text-2xl">{statusType === 'error' ? '⚠️' : statusType === 'success' ? '✓' : 'ℹ️'}</span>
                    {statusMessage}
                  </p>
                </div>

                {/* DYNAMIC INPUT SECTION */}
                <div className="relative mb-6">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 block">
                    {getCurrentPrompt()}
                  </label>

                  {/* CONDITIONAL RENDERING: SHOW DROPDOWN OR TEXT INPUT */}
                  {scanMode === 'location' && validLocations.length > 0 ? (
                    /* --- DROPDOWN MENU FOR LOCATIONS --- */
                    <div className="relative">
                      <select
                        value={locationName}
                        onChange={(e) => {
                          const val = e.target.value;
                          if (val) {
                            setLocationName(val);
                            setScanMode('employee');
                            setStatus(`Location selected: ${val}. Now scan Employee.`, 'success');
                            playSound('success');
                          }
                        }}
                        className="w-full bg-slate-950 border border-slate-700 text-white text-xl font-mono rounded-xl p-5 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 appearance-none cursor-pointer shadow-inner"
                      >
                        <option value="">-- Select Location --</option>
                        {validLocations.map((loc) => (
                          <option key={loc} value={loc}>
                            {loc}
                          </option>
                        ))}
                      </select>
                      {/* Arrow Icon overlay */}
                      <div className="absolute right-5 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                        ▼
                      </div>
                    </div>
                  ) : (
                    /* --- STANDARD TEXT INPUT WITH TYPEAHEAD --- */
                    <>
                      <input
                        ref={inputRef}
                        type="text"
                        value={scanInput}
                        onChange={handleInputChange} 
                        onKeyDown={handleScan}
                        placeholder="Scan here..."
                        className="w-full bg-slate-950 border border-slate-700 text-white text-2xl font-mono rounded-xl p-5 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all shadow-inner placeholder-slate-800"
                        autoFocus
                        disabled={isSubmitting}
                      />
                      <div className="absolute right-5 top-11 text-slate-700 animate-pulse">
                        <svg 
                          xmlns="http://www.w3.org/2000/svg"
                          width="32" 
                          height="32" 
                          fill="#3fb0e9" 
                          viewBox="0 0 256 256"
                          >
                              <path d="M215.79,118.17a8,8,0,0,0-5-5.66L153.18,90.9l14.66-73.33a8,8,0,0,0-13.69-7l-112,120a8,8,0,0,0,3,13l57.63,21.61L88.16,238.43a8,8,0,0,0,13.69,7l112-120A8,8,0,0,0,215.79,118.17ZM109.37,214l10.47-52.38a8,8,0,0,0-5-9.06L62,132.71l84.62-90.66L136.16,94.43a8,8,0,0,0,5,9.06l52.8,19.8Z"></path>
                              </svg>
                      </div>

                      {/* --- SUGGESTION LIST DROPDOWN (NEW!) --- */}
                      {suggestions.length > 0 && (
                        <div className="absolute z-50 w-full mt-2 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl max-h-60 overflow-y-auto custom-scrollbar">
                            {suggestions.map((part, index) => (
                            <div 
                                key={index} 
                                onClick={() => selectSuggestion(part)}
                                className="p-3 hover:bg-blue-600/20 hover:text-blue-200 cursor-pointer border-b border-slate-800 last:border-0 text-slate-300 transition-colors"
                            >
                                {part}
                            </div>
                            ))}
                        </div>
                      )}
                    </>
                  )}
                </div>

                {/* Quick Action Buttons (Only visible in Action Mode) */}
                {scanMode === 'action' && (
                  <div className="grid grid-cols-2 gap-2">
                    {['Receive', 'Send'].map((act, idx) => (
                      <button
                        key={act}
                        onClick={() => {
                          setAction(act);
                          if (act === 'Receive') {
                            setLocationName('Vendor / Inbound');
                            setScanMode('employee'); 
                            setStatus('Action: RECEIVE. Scan Employee Name.', 'success');
                          } else {
                            setScanMode('location');
                            setStatus('Action: SEND. Scan Destination.', 'success');
                          }
                          playSound('success');
                        }}
                        className="py-4 rounded-xl bg-slate-800 border border-slate-700 hover:border-blue-500 hover:bg-slate-700 text-slate-300 hover:text-white transition-all font-bold uppercase tracking-wider text-sm group"
                      >
                        <span className="block text-xs text-slate-600 mb-1 group-hover:text-blue-400">{idx + 1}</span>
                        {act}
                      </button>
                    ))}
                  </div>
                )}
                
                {/* Submit Button (Only visible in Part Mode and if parts exist) */}
                {scanMode === 'part' && parts.length > 0 && (
                  <button
                    onClick={handleSubmit}
                    disabled={isSubmitting}
                    className="w-full mt-4 py-4 rounded-xl bg-green-600 hover:bg-green-700 text-white font-bold uppercase tracking-wider text-lg transition-all shadow-[0_0_20px_-5px_rgba(22,163,74,0.5)] disabled:opacity-50"
                  >
                    {isSubmitting ? 'Submitting...' : '✅ Finalize & Submit Manifest'}
                  </button>
                )}

              </div>
            </div>

            {/* RIGHT COLUMN: DATA & LISTS */}
            <div className="space-y-6">
              
              {/* Session Info Card */}
              <div className="bg-slate-900/80 backdrop-blur border border-slate-800 p-6 rounded-2xl shadow-lg">
                <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Current Manifest</h3>

                {/* BALANCED LAYOUT: 3 Equal Columns */}
                <div className="grid grid-cols-3 gap-3 mb-4">
                  
                  {/* ACTION */}
                  <div className="p-3 bg-slate-950 rounded-xl border border-slate-800 flex flex-col justify-center">
                    <span className="block text-[10px] text-slate-500 uppercase tracking-wider mb-1">Action</span>
                    <span className="text-blue-400 font-bold text-sm md:text-base leading-none">
                      {action || '...'}
                    </span>
                  </div>

                  {/* LOCATION (With Auto-Fit Text) */}
                  <div className="p-3 bg-slate-950 rounded-xl border border-slate-800 flex flex-col justify-center relative overflow-hidden">
                    <span className="block text-[10px] text-slate-500 uppercase tracking-wider mb-1">Location</span>
                    
                    <span className={`font-bold text-white leading-tight break-words
                      ${(locationName && locationName.length > 10) ? 'text-xs md:text-sm' : 'text-sm md:text-base'}
                    `}>
                      {locationName || '...'}
                    </span>
                  </div>

                  {/* EMPLOYEE */}
                  <div className="p-3 bg-slate-950 rounded-xl border border-slate-800 flex flex-col justify-center">
                    <span className="block text-[10px] text-slate-500 uppercase tracking-wider mb-1">Employee</span>
                    <span className="text-green-400 font-bold text-sm md:text-base leading-none truncate">
                      {employeeName || '...'}
                    </span>
                  </div>
                  
                </div>

                <div className="border-t border-slate-800 pt-4">
                  <div className="flex justify-between items-end mb-2">
                    <span className="text-sm text-slate-400">Scanned Items</span>
                    <span className="text-xs bg-blue-900/30 text-blue-400 px-2 py-1 rounded border border-blue-500/20">{parts.length}</span>
                  </div>
                  
                  {/* Scrollable Parts List */}
                  <div className="space-y-2 max-h-[300px] overflow-y-auto pr-1 custom-scrollbar">
                    {parts.length === 0 ? (
                      <div className="text-center py-8 opacity-20">
                        <svg xmlns="http://www.w3.org/2000/svg"
                          width="32" 
                          height="32"
                          fill="#3fb0e9"
                          viewBox="0 0 256 256"
                          className="mx-auto">
                          <path d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,32l80.34,44-29.77,16.3-80.35-44ZM128,120,47.66,76l33.9-18.56,80.34,44ZM40,90l80,43.78v85.79L40,175.82Zm176,85.78h0l-80,43.79V133.82l32-17.51V152a8,8,0,0,0,16,0V107.55L216,90v85.77Z"></path>
                        </svg> 
                        <p className="text-xs">No items scanned</p>
                      </div>
                    ) : (
                      parts.map((p) => (
                        <div key={p.id} className="group flex justify-between items-center p-3 bg-slate-950 border border-slate-800 rounded-lg hover:border-slate-600 transition-colors">
                          <div className="overflow-hidden">
                            <p className="text-white text-sm font-medium truncate">{p.part}</p>
                            <p className="text-xs text-slate-500">Qty: <span className="text-blue-400">{p.quantity}</span></p>
                          </div>
                          <button onClick={() => removePart(p.id)} className="text-slate-600 hover:text-red-400 transition-colors px-2">✕</button>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PartsTracker />);
  </script>
</body>
</html>
